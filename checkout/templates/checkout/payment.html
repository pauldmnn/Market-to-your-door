{% extends "base.html" %}
{% load static %}

{% block content %}
<div class="container">
    <h2>Payment</h2>

    <div class="order-summary mt-4">
        <h4>Order Summary</h4>
        <p>Order Number: <strong>{{ order.order_number }}</strong></p>
        <p>Total Amount: <strong>Â£{{ order.total_price|floatformat:2 }}</strong></p>
    </div>

    <button id="checkout-button" class="btn btn-success mt-3">Proceed to Payment</button>

    <script src="https://js.stripe.com/v3/"></script>
    <script>
        var stripe = Stripe("{{ stripe_public_key }}");
        var checkoutButton = document.getElementById("checkout-button");

        checkoutButton.addEventListener("click", function () {
            fetch("{% url 'create_checkout_session' %}", { method: "POST" })
                .then(response => response.json())
                .then(session => {
                    return stripe.redirectToCheckout({ sessionId: session.id });
                })
                .catch(error => console.error("Error:", error));
        });
    </script>
</div>
{% endblock %}
